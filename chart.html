<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>
  <script type="text/javascript" src="d3/d3.v3.js"></script>
</head>
<body>
<h4>Receiving data</h4>
<script>
  var ws = new WebSocket('ws://localhost:54014');
  console.log('ws client ready!');
  var dataset = [];

  // Disconnect the ws client
  function disconnect() {
    ws.close();
    console.log('disconnected!');
    console.log(JSON.stringify(dataset));
    draw();
  }

  window.setTimeout(disconnect, 10000);

  ws.onmessage = function(v) {
    var newData = JSON.parse(v.data);
    dataset.push(newData);
    console.log('data list ' + dataset);
  }

  function draw() {
    console.log('drawing...');
    var width = 1100,
        height = 200;

    var svg1 = d3.select('body')
                .append('svg')
                .attr('width', width)
                .attr('height', height);

    console.log('svg ready');

    var attentionCircles = svg1.selectAll('circle')
                              .data(dataset)
                              .enter()
                              .append('circle');

    attentionCircles.attr('cx', function(d, i) {
              return (i * 100) + 100;
           })
           .attr('cy', height/2)
           .attr('r', function(d) {
              return d['eSense']['attention'];
           });

    var svg2 = d3.select('body')
                 .append('svg')
                 .attr('width', width)
                 .attr('height', height);

    var meditationCircles = svg2.selectAll('circle')
                               .data(dataset)
                               .enter()
                               .append('circle');

    meditationCircles.attr('cx', function(d, i) {
                        return (i * 100) + 100;
                     })
                     .attr('cy', height/2)
                     .attr('r', function(d) {
                        return d['eSense']['meditation'];
                     });
  }

</script>
</body>
</html>
